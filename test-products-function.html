<!DOCTYPE html>
<html>
<head>
    <title>Test Products Function</title>
</head>
<body>
    <h1>Testing Products Edge Function</h1>
    <div id="results"></div>

    <script>
        const SUPABASE_URL = 'https://xrhlumtimbmglzrfrnnk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyaGx1bXRpbWJtZ2x6cmZybm5rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTc1MDgsImV4cCI6MjA4NTA5MzUwOH0.fvE4LYnPQ0HI7JiChZdDgLKcnyk3WdeS2iLLn4cYMRw';
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.padding = '10px';
            div.style.border = '1px solid #ccc';
            div.style.borderRadius = '5px';

            if (type === 'error') {
                div.style.backgroundColor = '#fee';
                div.style.color = '#c00';
            } else if (type === 'success') {
                div.style.backgroundColor = '#efe';
                div.style.color = '#0c0';
            } else {
                div.style.backgroundColor = '#eef';
            }

            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        async function testProductsFunction() {
            try {
                log('Testing Products Edge Function...', 'info');

                const response = await fetch(`${SUPABASE_URL}/functions/v1/products`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`Response status: ${response.status} ${response.statusText}`, 'info');

                const text = await response.text();
                log(`Response body: ${text}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    try {
                        const data = JSON.parse(text);
                        log(`Parsed JSON: ${JSON.stringify(data, null, 2)}`, 'success');
                    } catch (e) {
                        log(`Could not parse as JSON: ${e.message}`, 'error');
                    }
                }

            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Run test
        testProductsFunction();
    </script>
</body>
</html>
